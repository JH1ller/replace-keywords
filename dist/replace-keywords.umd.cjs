(function(a,s){typeof exports=="object"&&typeof module<"u"?module.exports=s():typeof define=="function"&&define.amd?define(s):(a=typeof globalThis<"u"?globalThis:a||self,a.ReplaceKeywords=s())})(this,function(){"use strict";var u=Object.defineProperty;var g=(a,s,e)=>s in a?u(a,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[s]=e;var f=(a,s,e)=>(g(a,typeof s!="symbol"?s+"":s,e),e);class a{constructor(e,n){f(this,"element");f(this,"config");this.config=n,this.attach(e)}attach(e){if(!(e instanceof HTMLElement)){console.error("Element must be of type 'HTMLElement'.");return}if(e.contentEditable!=="true"){console.error(`Element does not have 'contenteditable="true"' attribute.`);return}this.element&&this.detach(),e.addEventListener("keyup",()=>this.keyupHandler()),this.element=e}detach(){this.element?(this.element.removeEventListener("keyup",()=>this.keyupHandler()),this.element=void 0):console.warn("Detach failed, element is not attached")}get transformations(){return this.config.transformations??[]}set transformations(e){this.config.transformations=e}keyupHandler(){const e=this.getPrecedingText(),n=this.getLastWordInText(e);for(const{query:r,value:t,appendSpace:o}of this.config.transformations){const i=r instanceof RegExp,d=e.length-n.length,l=i?n.match(r):null;if(l||r===n&&!i){let c=typeof t=="function"?t(n,r,l):t;(o??!0)&&(c+="Â "),this.replaceHtml(c,d,d+n.length);const h=new CustomEvent("replace",{detail:{oldValue:n,newValue:c,config:{query:r,value:t,appendSpace:o}}});this.element.dispatchEvent(h)}}}replaceHtml(e,n,r){const t=window.getSelection();let o=document.createRange();t!=null&&t.anchorNode&&(o.setStart(t==null?void 0:t.anchorNode,n),o.setEnd(t.anchorNode,r)),o.deleteContents();const i=document.createElement("div");i.innerHTML=e;const d=document.createDocumentFragment();let l,c;for(;l=i.firstChild;)c=d.appendChild(l);o.insertNode(d),c&&(o=o.cloneRange(),o.setStartAfter(c),o.collapse(!0),t==null||t.removeAllRanges(),t==null||t.addRange(o))}getPrecedingText(){var o,i;let e="";const n=(o=window.getSelection())==null?void 0:o.anchorNode,r=n==null?void 0:n.textContent,t=(i=window.getSelection())==null?void 0:i.getRangeAt(0).startOffset;return r&&t&&t>=0&&(e=r.substring(0,t)),e}getLastWordInText(e){e=e.replace(/\u00A0/g," ");const n=e.split(/\s+/),r=n.length-1;return n[r].trim()}}return a});
